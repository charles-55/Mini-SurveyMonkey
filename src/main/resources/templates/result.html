<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Result</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
	<link href="/css/main.css" rel="stylesheet">
	<script src="/js/main.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<h3 class="title" th:text="'Results for Survey - ' + ${survey.name}" />
<hr>

<div class="allQuestions" th:each="question, iterator : ${survey.questions}">
    <p class="question" th:text="'Question ' + ${iterator.count}"/>
    <p class="question" th:text="${question.content} "/>

    <div th:switch="${question.type.toString()}">
        <div th:case="'OPEN_ENDED'" th:each="answer: ${question.answers}">
            <ul th:each="answer: ${question.answers}">
                <li th:text="${answer}"/>
            </ul>
        </div>
        <div th:case="'NUMBER'">
            <div>
	            <canvas id="histogramChart" width="400" height="300"></canvas>
	            <script th:inline="javascript">
		            /*<![CDATA[*/
		            const map = /*[[${question.getAnswerAsMap()}]]*/ null;
		            /*]]>*/

		            const values = Object.values(map);
					const keys = Object.keys(map)

		            const ctx = document.getElementById('histogramChart');
		            const config = {
			            type: "bar",
			            data: {
				            labels: keys,
				            datasets: [{
					            label: "Number of Selections",
					            data: values}],
			            }
		            };

		            new Chart(ctx, config);
	            </script>
            </div>
        </div>
        <div th:case="'OPTION'">
            <div th:each="option: ${question.getAnswerAsMap().keySet()}">
                <p th:text="${option} + ': ' + ${question.getAnswerAsMap().get(option)}"></p>
            </div>
        </div>
    </div>
</div>


<!--&lt;!&ndash; Display pie chart for options and answer counts &ndash;&gt;-->
<!--<div th:if="${optionsAndAnswerCounts}">-->
<!--    <h2>Pie Chart: Options and Answer Counts</h2>-->
<!--    <span id="chartIndex" th:text="${iterator.index}" style="display: none;"></span>-->

<!--    &lt;!&ndash; Add your code to display the pie chart using optionsAndAnswerCounts data &ndash;&gt;-->
<!--    &lt;!&ndash; You may need to use JavaScript or a chart library for this purpose &ndash;&gt;-->
<!--    &lt;!&ndash; Render pie chart here using the question.answers &ndash;&gt;-->
<!--    <canvas th:id="'pieChart' + ${iterator.index}" width="400" height="400"></canvas>-->
<!--    <script th:inline="javascript">-->
<!--        /* Extract option values and answer counts for the pie chart */-->
<!--        var options = /*[[${question.options}]]*/ [];-->
<!--        var counts = /*[[${question.answerCounts}]]*/ [];-->

<!--        /* Use JavaScript to create a pie chart with Chart.js */-->
<!--        var ctx = document.getElementById('pieChart' + document.getElementById('chartIndex').textContent).getContext('2d');-->
<!--        var myPieChart = new Chart(ctx, {-->
<!--            type: 'pie',-->
<!--            data: {-->
<!--                labels: options,-->
<!--                datasets: [{-->
<!--                    data: counts,-->
<!--                    backgroundColor: [-->
<!--                        'rgba(255, 99, 132, 0.7)',-->
<!--                        'rgba(54, 162, 235, 0.7)',-->
<!--                        'rgba(255, 206, 86, 0.7)',-->
<!--                        // Add more colors as needed-->
<!--                    ],-->
<!--                    borderWidth: 1-->
<!--                }]-->
<!--            },-->
<!--            options: {-->
<!--                responsive: true,-->
<!--                maintainAspectRatio: false,-->
<!--                // Add more chart options as needed-->
<!--            }-->
<!--        });-->
<!--    </script>-->
<!--</div>-->

<!--<div th:unless="${question.type == 'OPTION'}">-->
<!--    &lt;!&ndash; Render other types of questions as needed &ndash;&gt;-->
<!--    <div th:each="answer: ${question.answers}">-->
<!--        <p th:text="${answer}" />-->
<!--    </div>-->
<!--</div>-->


</body>
</html>