<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <title>Create a Survey - MiniSurveyMonkey</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        $(document).ready(function() {
            // Counter to keep track of add-question-btn clicks
            let clickCounter = 1; // starts off with 1 question
            // Event listener for the button click
            $('#add-question-btn').on('click', function() {
                clickCounter++;
                $.ajax({
                    url: '/survey/add-question',
                    type: 'POST',
                    // type: 'GET',
                    contentType: 'application/json',
                    dataType: 'html',
                    data: JSON.stringify({ clicks: clickCounter }),
                    success: function(response) {
                        $('#questions-container').html(response)
                        // Handle the response data
                        console.log(response);
                    },
                    error: function(error) {
                        console.error('Error:', error);
                    }
                });
            });

            $("#submit-survey-btn").on("click", function() {
                // Submit both forms
                $("#survey-form").submit();
                // $("#questions-form").submit();
            });
        });
    </script>
</head>
<body>

<div class="container mt-5" id="main-container">
    <h2>Create a Survey</h2>
    <p>
        Create a survey by adding questions.
        You can select from 3 types of questions: open-ended, range, and multiple-choice questions.
    </p>
    <br>
    <form id="survey-form" action="#" th:action="@{/survey/add}" th:object="${survey}" method="post">
        <div class="form-group">
            <label for="title-input">Enter Survey Title:</label>
            <input type="text" th:field= "*{name}" class="form-control" id="title-input">
        </div>
    </form>
    <br>
    <h3>Add Questions to your Survey</h3>
    <div id="questions-container">
        <form id="questions-form" action="#" th:action="@{/survey/add/questions}" th:object="${survey}" method="post">
            <div id="question-container" class="form-group question-inputs" th:each="question, itemStat : *{questions}">
                <label for="dropdown-options">Select your question type</label>
                <select th:field="*{questions[__${itemStat.index}__].type}" class="form-control" id="dropdown-options">
                    <option value="open-ended">Open-Ended</option>
                    <option value="range">Range</option>
                    <option value="option">Multi-choice</option>
                </select>
                <br>
                <label for="content-input">Enter question content:</label>
                <input th:field="*{questions[__${itemStat.index}__].content}" class="form-control" id="content-input"/>
            </div>
        </form>
    </div>
    <div class="form-group">
        <button type="button" class="btn btn-primary mt-3" id="add-question-btn" >Add Question (+)</button>
        <button type="submit" class="btn btn-primary mt-3" id="submit-survey-btn">Submit Survey</button>
    </div>
</div>

</body>
</html>